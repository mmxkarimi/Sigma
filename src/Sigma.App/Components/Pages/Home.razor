@page "/"
@using Sigma.App.Components.Layout

<main class="bg-light vh-100 d-flex flex-column">

    <!-- Navbar -->
    <nav class="navbar navbar-dark bg-dark sticky-top">
        <div class="container-fluid">
            <!-- Mobile sidebar toggle -->
            <button class="btn btn-outline-light d-md-none" type="button" data-bs-toggle="offcanvas" data-bs-target="#sidebarOffcanvas" aria-controls="sidebarOffcanvas">
                ☰
            </button>
            <span class="navbar-brand mb-0 h1">Project Sigma</span>
        </div>
    </nav>

    <!-- Main Container -->
    <div class="container-fluid flex-grow-1">
        <div class="row">

            <!-- STATIC Sidebar (Desktop & Larger) -->
            <div class="col-md-2 d-none d-md-flex flex-column bg-white border-end p-3">
                <SideBar></SideBar>
            </div>

            <!-- CHAT AREA -->
            <div class="col-md-10 d-flex flex-column" style="height: calc(100vh - 56px);">
                <div class="flex-grow-1 overflow-auto p-3">
                    @if (!Messages.Any())
                    {
                        <div class="alert alert-primary" role="alert">
                            <p>Start chat with sigma</p>
                        </div>
                    }
                    @foreach (var item in Messages)
                    {
                        @if (item.Role == Sigma.App.Extensions.Models.ChatRole.User)
                        {
                            <div class="d-flex justify-content-end mb-3">
                                <div class="bg-dark text-white rounded p-2">
                                    @item.Prompt
                                </div>
                            </div>
                        }
                        if (item.Role == Sigma.App.Extensions.Models.ChatRole.Assistant)
                        {
                            <div class="d-flex mb-3">
                                <div class="bg-secondary text-white rounded p-2">
                                    @item.Prompt
                                </div>
                            </div>
                        }
                    }
                    @if (Disabled)
                    {
                        <span class="spinner-border" role="status"></span>
                    }
                </div>

                <div class="p-3 border-top bg-body" style="flex-shrink: 0;">
                    <div class="d-flex">
                        <textarea class="form-control me-2" placeholder="Type your message..." @bind=Message disabled="@Disabled"></textarea>
                        <button class="btn btn-dark " @onclick=SendMessage disabled="@Disabled">
                            <p>Send</p>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- OFFCANVAS Sidebar (Mobile only) -->
    <div class="offcanvas offcanvas-start d-md-none" tabindex="-1" id="sidebarOffcanvas">
        <div class="offcanvas-header">
            <h5 class="offcanvas-title">Sigma </h5>
            <button type="button" class="btn-close" data-bs-dismiss="offcanvas"></button>
        </div>
        <div class="offcanvas-body d-flex flex-column">
            <SideBar></SideBar>
        </div>
    </div>
</main>



<Modal @ref="myModal" @bind-IsVisible="showModal" Size="modal-lg">

    <HeaderContent>
        <h5 class="modal-title">Error</h5>
    </HeaderContent>

    <BodyContent>
       <p>@Error</p>
    </BodyContent>

    <FooterContent>
        <p></p>
    </FooterContent>
</Modal>